#!/bin/bash

#
# Install npm packages using the alterate versions of node and npm
# installed via pre_build
#
# OpenShift environment variables have a trailing slash
#

echo "Starting build hook"

cd $OPENSHIFT_REPO_DIR

if [[ -f "package.json.bak" ]]; then
    mv package.json.bak package.json
fi

npm install

# Bower wants to write to $HOME/config, but that's not writeable
# Temporarily change the value of $HOME
BOWER_TMP_HOME="$HOME/.node_modules/bower"
mkdir -p "$BOWER_TMP_HOME"

ORIGINAL_HOME="$HOME"
HOME="$BOWER_TMP_HOME"
bower install
HOME="$ORIGINAL_HOME"

echo "Finished build hook"
